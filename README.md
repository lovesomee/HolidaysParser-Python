# Holidays Parser

Парсер праздников и событий с сайта [kakoysegodnyaprazdnik.ru](https://kakoysegodnyaprazdnik.ru) за март 2026 года.
Скрипт автоматически создаёт базу данных SQLite и сохраняет праздники и события.

---

## 1. Установка

1. Клонировать репозиторий:

```bash
git clone <URL> HolidaysParser
cd HolidaysParser
```

2. Создать виртуальное окружение:

```bash
# Windows
python -m venv venv
venv\Scripts\activate

# Linux / macOS
python -m venv venv
source venv/bin/activate
```

3. Установить зависимости:

```bash
pip install -r requirements.txt
```

4. Установить браузеры для Playwright:

```bash
playwright install
```

> Без этого браузеры Chromium, Firefox и WebKit не будут работать.

---

## 2. Запуск

```bash
python main.py
```

* Скрипт создаёт базу `holidays.db` автоматически.
* Данные за март 2026 года сохраняются в таблицах `holidays` и `events`.
* После успешного запуска в терминале выводятся все спарсенные праздники и события.

---

## 3. Требования

* Python 3.10+
* Playwright 1.58.0
* Системные зависимости для браузеров Playwright (устанавливаются через `playwright install`)

---

## 4. Схема базы данных

### Таблица `holidays`

| Поле        | Тип     | Описание                                          |
| ----------- | ------- | ------------------------------------------------- |
| date        | TEXT    | Дата праздника                                    |
| name        | TEXT    | Название праздника                                |
| category    | TEXT    | Категория (general, orthodox, national, name_day) |
| country     | TEXT    | Страна (для национальных праздников)              |
| years_count | INTEGER | Кол-во лет (если указано)                         |
| years_year  | INTEGER | Год основания (если указано)                      |

### Таблица `events`

| Поле | Тип     | Описание         |
| ---- | ------- | ---------------- |
| date | TEXT    | Дата события     |
| name | TEXT    | Название события |
| year | INTEGER | Год события      |

**Почему выбрана такая структура:**

* 2 таблицы проще, чем 5 отдельных для каждой категории, для хранения всех праздников и событий.
* `Optional` поля (`country`, `years_count`, `years_year`) позволяют хранить праздники без года или страны.
* Категория праздника (`category`) даёт возможность различать общие, православные, национальные и именины.

---

## 5. Логика парсера

* **Блоки праздников:** `div.listing_wr > div > span[itemprop='text']`

* **Категории праздников:**

  * `general` – обычные праздники
  * `orthodox` – православные
  * `national` – национальные (с указанием страны)
  * `name_day` – только именины, фильтруются по префиксу `Именины у ...`, источник отрезается

* **События:** `div.event_block.adv > div.event`

* **Обработка именин:** берутся только строки начинающиеся с `Именины у`

* **Обработка национальных праздников:** возможны одна или несколько стран через `-` в конце текста

---

## 6. Надёжность

* Таймауты загрузки страниц и элементов Playwright установлены (до 90 секунд)
* Retry на день: до 3 попыток при ошибке загрузки или парсинга
* Обработка ошибок парсинга без остановки скрипта
* Антибот-защита:

  * `headless=False`
  * Random паузы между элементами и днями
  * Длинные паузы раз в 7–10 дней

---

## 7. Виртуальное окружение

* Создаётся командой `python -m venv venv`
* Активируется:

  * Windows: `venv\Scripts\activate`
  * Linux/macOS: `source venv/bin/activate`
* Все зависимости устанавливаются внутри окружения (`pip install -r requirements.txt`)
* Не требуется установка глобальных пакетов Python

---

## 8. Результат работы

* **Файл SQLite:** `holidays.db`
* **Содержит данные за март 2026 года:** таблицы `holidays` и `events`
* **Доступ к данным:** можно открыть любым SQLite-клиентом или через `sqlite3`:

```bash
sqlite3 holidays.db
.tables
SELECT * FROM holidays LIMIT 5;
SELECT * FROM events LIMIT 5;
```

---

## 9. Запуск на других машинах

1. Скопировать проект
2. Создать venv и активировать
3. Установить зависимости и браузеры Playwright
4. Запустить `python main.py`

> Всё работает «из коробки», база создаётся автоматически.
